/*
 * ENU_Frame.cpp
 *
 *  Created on: 2013/06/11
 *      Author: bun
 */

#include "ENU_Frame.h"
#include <cmath>
#include <iostream>

CENU_Frame::CENU_Frame()
{
	wgs84_origin = CWGS84_Frame();

	e = 0.0L;
	n = 0.0L;
	u = 0.0L;

}

CENU_Frame::CENU_Frame(long double e_enu, long double n_enu, long double u_enu, const CWGS84_Frame &wgs84_orig)
{
	long double s1, c1, s2, c2;
	long double x0, y0, z0;

	CECEF_Frame ecef_f;

	e = e_enu;
	n = n_enu;
	u = u_enu;

	this->wgs84_origin = wgs84_orig;

	std::cout << "x = " << std::fixed << wgs84_origin.GetX() << "\n";

	s1 = sin(this->wgs84_origin.GetLongi());
	c1 = cos(this->wgs84_origin.GetLongi());
	s2 = sin(this->wgs84_origin.GetLat());
	c2 = cos(this->wgs84_origin.GetLat());

	x0 = -e * s1 - n * c1 * s2 + u * c1 * c2;
	y0 = e * c1 - n * s1 * s2 + u *s1 * c2;
	z0 = n * c2 + u * s2;

	std::cout << "x0 = " << std::fixed << x0 << "\n";

	x0 += this->wgs84_origin.GetX();
	y0 += this->wgs84_origin.GetY();
	z0 += this->wgs84_origin.GetZ();

	ecef_f = CECEF_Frame(x0, y0, z0);

	std::cout << "x = " << std::fixed << ecef_f.GetX() << "\n";

	this->Set(ecef_f);

}

CENU_Frame::CENU_Frame(const CENU_Frame &enu_f) : CWGS84_Frame(enu_f.Latitude, enu_f.Longitude, enu_f.Geoidal_Height)
{
	wgs84_origin = enu_f.wgs84_origin;

	e = enu_f.e;
	n = enu_f.n;
	u = enu_f.u;

}

CENU_Frame::CENU_Frame(CWGS84_Frame wgs84_f, CWGS84_Frame wgs84_orig) : CWGS84_Frame(wgs84_f)
{
	long double x1, y1, z1;
	long double s1, s2, c1, c2;

	this->wgs84_origin = CWGS84_Frame(wgs84_orig);

	x1 = wgs84_f.GetX() - wgs84_orig.GetX();
	y1 = wgs84_f.GetY() - wgs84_orig.GetY();
	z1 = wgs84_f.GetZ() - wgs84_orig.GetZ();

	s1 = sin(wgs84_orig.GetLongi());
	c1 = cos(wgs84_orig.GetLongi());
	s2 = sin(wgs84_orig.GetLat());
	c2 = cos(wgs84_orig.GetLat());

	e = -x1 * s1 + y1 * c1;
	n = -x1 * c1 * s2 - y * s1 * s2 + z * c2;
	u = x * c1 * c2 + y * s1 * c2 + z * s2;

}

CENU_Frame::~CENU_Frame()
{
	// Do nothing
}
